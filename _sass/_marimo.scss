/*******************************************************************************
 * Marimo notebook styles
 ******************************************************************************/

@use "variables";

.marimo-notebook {
  margin: 1.5rem 0;

  .marimo-embed-container {
    position: relative;
    width: 100%;
    border: 1px solid var(--global-divider-color);
    border-radius: 0.5rem;
    overflow: hidden;
    background-color: var(--global-bg-color);

    iframe {
      display: block;
      border: none;
      width: 100%;
    }
  }

  .caption {
    margin-top: 0.5rem;
  }
}

// Marimo snippet styling (for inline <marimo-iframe> elements)
marimo-iframe {
  display: block;
  margin: 1.5rem 0;
  border: 1px solid var(--global-divider-color);
  border-radius: 0.5rem;
  overflow: hidden;
  // Hide raw content (fenced code blocks as text) until JS processes them
  visibility: hidden;

  iframe {
    border: none;
    width: 100%;
  }
}

// Wrapper class for marimo inline notebooks (using markdown="1" for kramdown processing)
.marimo-notebook-inline {
  // Hide until JS converts <pre> elements into <marimo-iframe>
  visibility: hidden;

  // Style the marimo-iframe created by JS inside this wrapper
  marimo-iframe {
    margin: 0;
    border: none;
    border-radius: 0;
  }
}

// Dark/light mode for marimo iframes.
// marimo.app WASM iframes are cross-origin and default to light theme.
// There is no URL query param or postMessage API to control their theme.
// We use CSS filter inversion as a practical workaround:
//   invert(0.75) maps white (#fff) -> ~#404040 for a softer dark background,
//   and black text -> ~#bfbfbf for readable contrast.
//   hue-rotate(180deg) partially corrects the colour shift.
//   contrast(1.5) + brightness(1.2) widens the gap between cell outlines
//   and the background, making borders clearly visible.
html[data-theme="dark"] {
  .marimo-notebook iframe,
  .marimo-notebook-inline iframe {
    filter: invert(0.75) hue-rotate(180deg) contrast(1.5) brightness(1.2);
  }
}
